<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>成本计算</title>
    <link rel="icon" href="../res/img/favicon.png" type="image/png" >
    <link rel="stylesheet" href="../res/mobile/css/mobilePublic.css"/>
    <script type="text/javascript" src="../res/js/jquery-3.0.0.min.js"></script>
    <meta name="viewport"
          content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <style>
        .tab{
            width:100%;
            height:auto;
            text-align:center;
            padding:0;
            border: 1px solid black;
        }
        .tabSelected{
            background-color: black;
            color: white;
            border: 1px solid black;
        }
        .rate{
            width:100%;
            height:auto;
            line-height:0.4rem;
            text-align:left;
            padding:0.2rem;
        }
        .deal{
            width:100%;
            height:auto;
            line-height:0.4rem;
            text-align:left;
            padding:0 0.2rem;

        }
        .bs{
            height:auto;
            text-align:center;
            padding:0;
            border: 1px solid black;
        }
        .bsSelected{
            background-color: black;
            color: white;
            border: 1px solid black;
        }
        .result{
            width:100%;
            height:auto;
            line-height:0.4rem;
            text-align:left;
            padding:0.2rem;
        }
    </style>
    <script>
        (function (doc, win) {
            var docEl = doc.documentElement,
                resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',
                recalc = function () {
                    var clientWidth = docEl.clientWidth;
                    if (!clientWidth) return;
                    if(clientWidth>=640){
                        docEl.style.fontSize = '100px';
                    }else{
                        docEl.style.fontSize = 100 * (clientWidth / 640) + 'px';
                    }
                };

            if (!doc.addEventListener) return;
            win.addEventListener(resizeEvt, recalc, false);
            doc.addEventListener('DOMContentLoaded', recalc, false);
        })(document, window);

        function tabSelect(obj, param){
            $('.tab div').removeClass('tabSelected');
            $(obj).addClass('tabSelected');
            if(param == 'sz'){
                $('#ghslTxt').attr('disabled','disabled');
            }else{
                $('#ghslTxt').removeAttr('disabled');
            }
        }
        function bsSelect(obj, param){
            $('.bs div').removeClass('bsSelected');
            $(obj).addClass('bsSelected');
            if(param == 'sell'){
                $('#initPrice').css('display','block');
            }else{
                $('#initPrice').css('display','none');
            }
        }

        function calculate(){
            var market = $('.tabSelected').text();
            var deal = $('.bsSelected').text();
            var price = parseFloat($('#priceTxt').val());
            var quantity = parseFloat($('#quantityTxt').val());
            var amount = parseFloat((price * quantity).toFixed(2));
            var sxfl = parseFloat($('#sxflTxt').val());
            var ghsl = parseFloat($('#ghslTxt').val());
            var yssl = parseFloat($('#ysslTxt').val());
            var commission = parseFloat((amount*sxfl).toFixed(2));

            if(commission < 5){
                commission = 5;
            }
            var ghTax = 0;
            var stockTax = 0;
            var finalAmount = 0;
            if(market == '沪市'){
                ghTax = parseFloat((amount*ghsl).toFixed(2));
            }
            if(deal == '卖'){
                stockTax = parseFloat((amount*yssl).toFixed(2));
                finalAmount = amount - ghTax - stockTax - commission;
            }else{
                finalAmount = amount + ghTax + stockTax + commission;
            }
            finalAmount = parseFloat(finalAmount.toFixed(2));
            var template = '';
            template += '<div style="width:100%"><div class="left" style="width:30%">股票金额:</div><div class="left" style="width:70%">'+amount+'</div><div class="clear"></div></div>';
            template += '<div style="width:100%"><div class="left" style="width:30%">手续费:</div><div class="left" style="width:70%">'+commission+'</div><div class="clear"></div></div>';
            template += '<div style="width:100%"><div class="left" style="width:30%">印花税:</div><div class="left" style="width:70%">'+stockTax+'</div><div class="clear"></div></div>';
            template += '<div style="width:100%"><div class="left" style="width:30%">过户费:</div><div class="left" style="width:70%">'+ghTax+'</div><div class="clear"></div></div>';
            template += '<div style="width:100%"><div class="left" style="width:30%">成交金额:</div><div class="left" style="width:70%">'+finalAmount+'</div><div class="clear"></div></div>';
            if(deal == '买'){
                var sellPrice = 0;
                if(market == '沪市'){
                    sellPrice = parseFloat((finalAmount/(quantity * (1-sxfl-yssl-ghsl))).toFixed(2));
                    if(sellPrice * quantity * sxfl < 5){
                        sellPrice = parseFloat(((finalAmount+5)/(quantity*(1-yssl-ghsl))).toFixed(2));
                    }
                }else{
                    sellPrice = parseFloat((finalAmount/(quantity * (1-sxfl-yssl))).toFixed(2));
                    if(sellPrice * quantity * sxfl < 5){
                        sellPrice = parseFloat(((finalAmount+5)/(quantity*(1-yssl))).toFixed(2));
                    }
                }
                template += '<div style="width:100%"><div class="left" style="width:30%">保本价格:</div><div class="left" style="width:70%">'+sellPrice+'</div><div class="clear"></div></div>';
            }else{
                var profit = 0;
                var initPrice = 0;
                if($('#initPriceTxt').val()){
                    initPrice = parseFloat($('#initPriceTxt').val());
                }
                var sxf = initPrice*quantity*sxfl;
                if(sxf < 5){
                    sxf = 5;
                }
                if(market == '沪市'){
                    profit = (finalAmount - sxf - (initPrice*quantity*(1+ghsl))).toFixed(2);
                }else{
                    profit = (finalAmount - sxf - initPrice*quantity).toFixed(2);
                }
                if(profit < 0){
                    template += '<div style="width:100%"><div class="left" style="width:30%">盈亏金额:</div><div class="left" style="width:70%;color:green;">'+profit+'</div><div class="clear"></div></div>';
                }else{
                    template += '<div style="width:100%"><div class="left" style="width:30%">盈亏金额:</div><div class="left" style="width:70%;color:red;">'+profit+'</div><div class="clear"></div></div>';
                }
            }

            $('.result').html(template);
        }
    </script>
</head>
<body>
    <div class="tab">
        <div style="width:50%;height:0.5rem;line-height:0.5rem;" class="left tabSelected" onclick="tabSelect(this, 'sh')" >沪市</div>
        <div style="width:50%;height:0.5rem;line-height:0.5rem;" class="right" onclick="tabSelect(this, 'sz')" >深市</div>
        <div class="clear"></div>
    </div>
    <div class="splitLine"></div>
    <div class="rate">
        <div class="yssl"><div class="left" style="width: 3rem;">印花税率(默认 1‰):</div><input id="ysslTxt" type="text" value="0.001" class="left"><div class="clear"></div></div>
        <div class="sxfl"><div class="left" style="width: 3rem;">手续费率(默认 0.02‰):</div><input id="sxflTxt" type="text" value="0.0003"><div class="clear"></div></div>
        <div class="ghsl"><div class="left" style="width: 3rem;">过户税率(默认 0.3‰):</div><input id="ghslTxt" type="text" value="0.00002"><div class="clear"></div></div>
    </div>
    <div class="splitLine"></div>
    <div class="deal">
        <div class="left" style="width:20%">成交价格:</div>
        <div class="left" style="width:28%"><input id="priceTxt" type="text" style="width:100%"></div>
        <div class="left" style="width:4%;height:0.1rem;"></div>
        <div class="left" style="width:20%">成交数量:</div>
        <div class="left" style="width:28%"><input id="quantityTxt" type="text" style="width:100%"></div>
        <div class="clear"></div>
    </div>
    <div style="height:0.2rem;"></div>
    <div class="deal">
        <div class="left bs" style="width:20%;">
            <div style="width:50%;height:0.4rem;line-height:0.4rem;" class="left bsSelected" onclick="bsSelect(this, 'buy')">买</div>
            <div style="width:50%;height:0.4rem;line-height:0.4rem;" class="right" onclick="bsSelect(this, 'sell')">卖</div>
            <div class="clear"></div>
        </div>
        <div id="initPrice" class="left" style="width:60%;display:none;">
            <div class="left" style="width:40%;text-align:center;">买入价格:</div>
            <div class="left" style="width:60%"><input id="initPriceTxt" type="text" style="width:80%"></div>
            <div class="clear"></div>
        </div>
        <div class="right" style="width:20%;"><input id="calcBtn" type="button" value="计算" style="width:1rem;" onclick="calculate()"></div>
        <div class="clear"></div>
    </div>
    <div class="splitLine"></div>
    <div class="result">
        <div style="width:100%"><div class="left" style="width:30%">成交金额:</div><div class="left" style="width:70%">asdfasd</div><div class="clear"></div></div>
        <div style="width:100%"><div class="left" style="width:30%">保本价格:</div><div class="left" style="width:70%">asdfsadfa</div><div class="clear"></div></div>
        <div style="width:100%"><div class="left" style="width:30%">盈亏金额:</div><div class="left" style="width:70%">asdfasd</div><div class="clear"></div></div>
        <div style="width:100%"><div class="left" style="width:30%">手续费:</div><div class="left" style="width:70%">asdfasd</div><div class="clear"></div></div>
        <div style="width:100%"><div class="left" style="width:30%">印花税:</div><div class="left" style="width:70%">asdfasd</div><div class="clear"></div></div>
        <div style="width:100%"><div class="left" style="width:30%">过户费:</div><div class="left" style="width:70%">asdfasd</div><div class="clear"></div></div>
    </div>
</body>
</html>